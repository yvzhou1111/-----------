# 用户用水行为识别系统使用说明

## 一、系统概述
本系统是一个用于识别和分析用户用水行为的综合平台，基于Python开发，采用本地存储方式管理数据，具有实时监测、历史查询、数据上传分析和数据管理等功能。

## 二、快速启动

### 1. 启动全功能版本
使用以下命令启动系统（包括前端界面、后端API和自动数据推送）：
```bash
python run_app.py
```

这将同时启动：
- API服务器（默认端口8000）
- Streamlit前端界面（默认端口8501）
- 自动推送一个月的历史数据
- 自动推送实时模拟数据

启动后，在浏览器中访问 http://localhost:8501 即可使用系统。

### 2. 启动选项
系统提供多种启动选项，满足不同需求：

```bash
# 不推送历史数据
python run_app.py --no-history

# 不推送实时数据
python run_app.py --no-realtime

# 仅启动API服务器
python run_app.py --api-only

# 仅启动前端界面
python run_app.py --streamlit-only

# 指定设备号和IMEI
python run_app.py --device 70666000038000 --imei 860329065551923

# 指定历史数据天数（默认30天）
python run_app.py --history-days 15

# 指定实时数据推送持续时间（秒）
python run_app.py --realtime-duration 3600
```

## 三、系统功能

### 1. 实时监测
- 显示最新用水状态和统计信息
- 展示实时流量变化曲线
- 自动更新数据

### 2. 历史查询
- 选择日期范围查询历史数据
- 查看历史用水行为分类和统计
- 导出历史数据和报表

### 3. 数据上传分析
- 上传CSV或Excel格式的水表数据
- 系统自动分析用水行为模式
- 生成增强型可视化图表
- 导出分析结果

### 4. 数据管理
- 导出系统数据（CSV或Excel格式）
- 删除指定日期范围的数据
- 查看API和网络信息

### 5. 设备管理
- 查看设备列表和状态
- 新增或更新设备信息
- 批量导入设备

## 四、系统架构
- **前端**：基于Streamlit开发的交互式Web界面
- **后端**：基于FastAPI开发的RESTful API服务
- **存储**：本地文件存储（CSV格式）
- **数据处理**：使用Pandas进行数据处理和分析
- **可视化**：使用Plotly和Matplotlib生成图表

## 五、数据推送接口
系统提供RESTful API接口，用于接收水表数据：

- **接口地址**：`http://<服务器IP>:8000/api/data`
- **请求方法**：POST
- **请求格式**：JSON
- **示例数据**：
```json
{
  "deviceNo": "70666000038000", 
  "batteryVoltage": "3.45",
  "freezeDateFlow": "95.234",
  "imei": "860329065551923",
  "instantaneousFlow": "0.5",
  "pressure": "0.35",
  "reverseFlow": "0",
  "signalValue": "25",
  "startFrequency": "35",
  "temprature": "22.5",
  "totalFlow": "98.432",
  "valveStatu": "开",
  "updateTime": "2025-09-08 10:30:15"
}
```

## 六、注意事项
1. 系统使用本地存储，数据保存在CSV文件中，无需数据库配置
2. 系统会自动进行半年数据清理，请定期导出重要数据
3. 关闭系统时，请使用Ctrl+C终止程序，确保所有进程正确关闭 