# 用户用水行为识别系统 - 更新日志

## 2023-11-15：本地存储版本发布

### 主要变更

1. **移除数据库依赖**
   - 完全移除PostgreSQL数据库依赖，转为本地文件存储
   - 新增`local_storage.py`模块，提供完整的本地文件存储功能
   - 新增`api_server_local.py`，替代原有基于数据库的API服务器

2. **数据管理优化**
   - 实现半年自动数据清理机制，避免数据过多导致性能下降
   - 清理前自动备份数据，确保数据安全
   - 提供清理前7天的警告提示，方便用户导出重要数据

3. **新增数据推送工具**
   - 改进`push_history_data.py`，支持推送指定日期范围的历史数据
   - 改进`push_realtime_data.py`，支持模拟不同用水行为的实时数据推送
   - 两个工具均支持本地存储和数据库存储两个版本

4. **易用性提升**
   - 新增`init_local_storage.py`初始化工具，一键设置本地存储环境
   - 新增`run_local.py`启动脚本，简化本地存储版本的启动
   - 改进命令行参数支持，便于自动化部署

5. **文档更新**
   - 新增《本地存储版使用说明.md》文档，详细介绍本地版本的使用方法
   - 新增《数据推送指南.md》，介绍如何使用数据推送工具
   - 新增《更新日志.md》，记录项目变更历史

### 修复的问题

1. **登录状态丢失问题**
   - 修复刷新页面后登录状态丢失的问题
   - 改进token存储机制，使用URL参数保持登录状态

2. **数据推送类型错误问题**
   - 修复数据推送时数字类型与字符串类型不一致导致的错误
   - 统一所有API参数为字符串类型，提高兼容性

3. **API连接问题**
   - 修复API地址和端口配置问题，确保数据推送工具能够正确连接

### 技术详情

1. **本地存储实现**
   - 使用JSON文件存储用户和设备信息
   - 使用CSV文件存储水表数据
   - 实现缓存机制，提高查询效率

2. **数据清理机制**
   - 默认保留最近180天（半年）的数据
   - 清理前自动备份到data目录下
   - 在系统界面显示清理警告

3. **认证机制**
   - 保持与原有系统相同的JWT认证方式
   - 本地存储用户信息和密码哈希

## 后续计划

1. 优化数据分析算法，提高异常检测准确率
2. 添加更多数据可视化图表
3. 支持数据库与本地存储的数据迁移功能
4. 支持批量导入历史数据功能
5. 实现更多用水行为模式的识别 